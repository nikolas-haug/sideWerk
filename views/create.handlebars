<div class="container d-flex justify-content-center">
    <div class="row">
        <div class="col">
            <img class="header-img" src="/assets/images/logo.svg">
            <h1>Create New Board Page</h1>

            {{!-- TO DO - remove the excessive hrs --}}
            <hr>

            <a href="/home">Home</a>
            <a href="/board">view list board</a>

            <hr>

            <input class="form-control" id="list_name" type="text" placeholder="Enter list name">

            <ul class="list-group mt-3">
                {{#each items}}
                <li class="list-group-item" data-item_name="{{this.item_name}}">
                    {{ this.item_name }}
                </li>
                {{/each}}
            </ul>

            <button id="create-list-btn" class="btn btn-primary mt-2 w-100" onclick="addNewList()">submit</button>

            <hr>

            <!-- Small modal -->
            <button id="modal-btn" type="button">Open Modal</button>
            <div class="modal-div">
                <h2>Javascript Modal Box</h2>
                <p>You've opened the modal box!<br>Click to close me!</p>
            </div>

            <style>
                button {
                    border: 0;
                    padding: 10px;
                    font-family: 'Source Sans Pro', Verdana, Sans-Serif;
                    font-size: 18px;
                    outline: none;
                    border-radius: 3px;
                    display: block;
                    margin: 15px auto;
                    background-color: #E3E3E3;
                    cursor: pointer;
                    transition: opacity 1s ease, transform 0.5s ease;
                    -webkit-tap-highlight-color: rgba(0, 0, 0, 0)
                }

                button:active {
                    box-shadow: 0 0 15px 0 lightgrey inset;
                    background-color: #EBEBEB;
                    transform: scale(1.15, 1.15);
                    transition: transform 0s ease;
                }

                .modal-div {
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    /*must set position: relative for the body to remain behind the modal*/
                    background-color: #3D3D3D;
                    max-width: 600px;
                    min-width: 150px;
                    padding: 15px;
                    text-align: center;
                    margin: -50px auto 0 auto;
                    border-radius: 5px;
                    z-index: 4;
                    visibility: hidden;
                    opacity: 0;
                    cursor: pointer;
                    box-shadow: 0 0 5px 1px grey;
                    transition: all 0.25s ease;
                }

                .modal-div::before {
                    content: '';
                    background-color: rgba(0, 0, 0, 0.5);
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    /*must set z-index: -1 to keep the backdrop behind the modal box*/
                    z-index: -1;
                }

                h2 {
                    font-family: 'Montserrat', Verdana, Sans-Serif;
                    color: coral;
                }

                p {
                    font-family: 'Source Sans Pro', Verdana, Sans-Serif;
                    color: white;
                }
            </style>

            {{!-- start scripts --}}
            <script>

                // make the variables for the checkboxes and input field rows
                const listRow = document.querySelectorAll('.list-group-item');
                const listName = document.querySelector('#list_name');

                // varible for the modals
                var modal = document.querySelector('.modal-div');
                var button = document.querySelector('#modal-btn');

                var open = function () {
                    modal.style.visibility = 'visible';
                    modal.style.marginTop = '50px';
                    modal.style.opacity = '1';
                    button.style.opacity = '0';
                };

                button.addEventListener('click', open, false);

                var close = function () {
                    modal.style.visibility = 'hidden';
                    modal.style.marginTop = '-50px';
                    modal.style.opacity = '0';
                    button.style.opacity = '1';
                };

                modal.addEventListener('click', close, false);



                let newList = {};
                let newItems = [];

                listRow.forEach(item => item.addEventListener('click', getItemData));

                // function for the item checkboxes
                function getItemData(e) {
                    if (!this.classList.contains('item-selected')) {
                        this.classList.add('item-selected');
                        // get the new item data
                        let newItem = e.target.dataset.item_name;
                        // add it to the new items array
                        newItems.push(newItem);
                        console.log(newItems);
                    } else {
                        this.classList.remove('item-selected');
                        newItems = newItems.filter(item => item !== e.target.dataset.item_name);
                        console.log(newItems);
                    }
                }

                // function to handle the form submit after the new list has been created
                // send new data to post route in the database to create new list
                function addNewList() {
                    // TO DO - make these alerts show in the DOM
                    // check if list name is provided
                    if (!listName.value) {
                        return alert('please enter a list name.');
                    }
                    // check if anything has been selected from the list
                    if (newItems === undefined || newItems.length == 0) {
                        return alert('please select at least one item from the list.');
                    }

                    newList = {
                        items: newItems,
                        listName: listName.value
                    }

                    $.ajax({
                        type: 'POST',
                        url: "/list/create",
                        data: newList,
                        dataType: "text",
                        success: function (resultData) {
                            console.log(resultData);
                            window.location.href = "/board";
                        }
                    });
                }

            </script>

        </div>
    </div>
</div>